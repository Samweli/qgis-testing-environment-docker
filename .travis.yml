sudo: required

services:
  - docker

env:
  global:
      secure: "3bX5cbCekmZSjFX2W1dcDJNMp/de2Q6fcT/GjnerDp3paR8c9DAgEJZytP319ot/iRxlGDxdnZWS5UmEhftl/cXH6wEEjUXyh2Fwpn69kqyTGEVBYtJ9uJ3TFtfW27LXf48CWrRuulMKz4ncISYF2+4ekBY4Tsq2D9Y9Roj+lU2Wk0VTvTjljk5k/+kDL80aslUM0ZWs89sUj4B3jlI78ihesI7AcR7P99v3D0uxvYvx0CXgvWTSdTTGFBFKARB0K50EDvgvkJkDAXRbtCdk3ZUoCAbJkcz8Qx8qujD8U4ZCDuMub50BD6NQicVnGj5CJXWedvCQvku8mh4pfdVUMfeO/tkmwY7tFKRA7qWX1+NfMeVASrnTCZULjizNCBcvoGZseFzF6w72g14k7LZWTDfgbCGB+fSDoGTEglulST6OmEpl6Dj4ipeAG2BflQFT7oxekx5PxOyY2VsrMFWTc3aiDZsxqocA0nWurVGm560ab7iFTs2GHVSFK7vE2Kjt9GEqcWyRQqZZrmUbfMMr+QojRC2ef5f4IUcOaKSriC8jPv29/4kGKgJv/1cUgiaSOX73OSRtTptox88vRDBRqVcioORV+3/u72uUU8UEIzQX4nDh20R9y/jxlPizMQKaVivckqoVqkIxXT0QXViV8v6s716aaUFITclUrY7G8o4=" # DOCKER_EMAIL
      secure: "M0jfbRMYJqYny8MDc6uFsQJC+RzUZQIq8o5lT2fXCh3QsUg5DoPpBxHoLV/ASbPSWXVyTtPsrTKG83GcIXz/j/gdwIkfvnJ8/3+ixcG30Y0uvg8sVJgpe4PPymwfd/tdTXLhkFlYsvDx9JHrguc1XyhnAxFrnuZgIOVI0NSAn7Hj9LhWLkegSDtN8bdG7FRanNOvNtAiK9ROHwiSnhURyaRxGqo5EUvCVrotsRhxN81L8OQ8zUSE/Z+rvqvQ87xrtGo6SOdqt570wRWZGUJepGasLan3Hk4iYWizEtydm+Zb3j2No/DkczJQ2P7XzhwpELgZGW/MEHZg8OIO8y16AWyC3osQNGAxuTNIJnzGmuF3oLehXK8AwZsJKUvlFy/9FB50QDYvFnToPBWuP++OcYwS7zWEoP0tmtobl+erFWxGW5wTc8IhtALnfTb1WTBF/szTNU31v+2lxx1EYI+xxT1wc2k1kWt3kc0WbLygOV0rOiSwXwuBKYCDfMxNbctX1tpGicD17Pf+5brBktz4Wz9qaExBUm1+cVHFCK23tljVWqk5Ni+YQLxDMFgXZo0wEfP7TYmKjz+enVu13r/dl/L1d7lT2wwEtIPPSvj6hCBTTbkQnpWSZVf77zicFN/L2cV1yHsAqrXMgalisSNr69X6l6CejZmUgqE3gmbA7Cw=" # DOCKER USERNAME
       secure: "kRZJsAHrxgjL41uKxqRJYOnLw0p3hOq8aMRwEalVBYpVIlkkjMxbM28Sq2xrb4FlbbehIJndlScDh373qNrz9xhmxyrWui4FR+BOUx3OHEp1z5g3gNLT+PX2/2KCzfzi4Xns/MYvFVOQNu1zPO9e5YHiExO07hbmsakGEXpDLWGQ1ss0dbvgzXs20AjV1YXLsiXqeptUqLWBftXM6Z/jQyrCuB5SvL9dMMQi0FyAubsFZabENiQK5oKlYXE5FzF6Wbhc0im2HO/Qlg1QCPygBTGmFQ8dEFmp/CyAz63+N7yzJrxCm9SWqc+vKtzGwVOGMM3NzgnMRRWUSS7QDTLJsGpSzCWcfG4ObsQKsF//1doF/RD3k4pbPMPWcEorpZ/bg9lRj9ZRjqJaK9v7qcoqDaDhj9bmpkh0PHyU5Ei+S/ON8Fif3lWsK188doUB4qLeAuFJ2qvHU/PAZsFNBjXjXaBV64JHu555SZBieY4hXmWEtfE9Z3aJMuqAxfkcIynA8rWKXsxBDKJ9U0bsBmW/YKzGPNDDW0aAxBzEUlnPfWDn7vK9PO56muhXmBuBXWZK3yXR5vQQL+yUnWHh3B+qXGmglsV0qC2JE/cx3PmpJSsbdpagbHM2qIL1T3gff7EAZDoXK62ULmUp9HY9uUOU8vCQZ9N6cm6IGDB26etgSI0=" # DOCKER PASSWORD

    - COMMIT=${TRAVIS_COMMIT::8}

after_success:
  - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
  - export REPO=elpaso/qgis-testing-environment
  - export TAG=`if [ "$TRAVIS_BRANCH" == "master" ]; then echo "latest"; else echo $TRAVIS_BRANCH ; fi`
  - docker build -f Dockerfile -t $REPO:$COMMIT .
  - docker tag $REPO:$COMMIT $REPO:$TAG
  - docker tag $REPO:$COMMIT $REPO:travis-$TRAVIS_BUILD_NUMBER
  - docker push $REPO
