sudo: required
language: generic
services:
  - docker
env:
  global:
    - secure: "qIdSBYAoHjDS2rjnd/tGKWW9+oJ1jvnm3l2Zm2SZqTgoDXnroLC8iG4ctAJs94OoyPbl2QLm84ZUM61uKXYw3FoARbt9EEYp3s9erHa9TJhN/c3xJ2yddmpLMlh56r9NpAIaMAkTzM79RM9Z1lKq4GMhqItQYxeJqDKdha/O8kuMAt98AKvC235jtZRIxmwzBP+xLbYq/tTnTqH5Il3jIm0v0XF+FAyay48UFr3b+usoCbog05fleevumFVNtjiboupnFONQFIwK+uPivy3ek22VQnLHOxsjJQUi6nN+hH0219i67zVy3J/SGnAdxmZrvoTv/gxOCKuuSBI9iCXQFKJTaPC93yKd3TN4JT66ApGB+Z3F9V09vRHEk4NOWGZ4WgF0Ems3HYFK2jt/cNOwtBluWJjg9zdGTyXUc6B2PdM7tfJg+bP+Et4bWuSaMm7yKwd3GjVm0YPByeykwiw2n9N9MQyqNiGvuP5oyCGGH13jamwn5NuRBN07sg9K95/NqjYlTIaJ30QEozjENveynZ65FoP3kVdUf5nHeMw6PanP8bW/F6XSe5jSQ75KdZISvrD1zeclNWtdqyrVf/BxCrroHZKXkn+Zpcj1n2IYz9OO/cyQzgX0qb/L3BAbNNnNuCMn35JbedJV4jVS3gXDalk8qz0ZYV62Sw92ZaXiIPE=" # DOCKER PASSWORD
    - secure: "Ge9bhtTiUXSzJxOarR9cIGnBWMsgBtwWCGxO8wHdDWxChwgowtOQuU3yyVZ1Wqm94fY2aWTbrjKlkQL9gyF1Rf/tmtfkp6Pgc2BfMcv6aMGM4kaL0KY2jxadVI+3yluVzuYoxICYBspfTazUvI2g/RhNEMZVOZfjYRJANZMTeJg5Q1oxMwaFpawdaVrU05RM3CyQeqD/KN4NXezFN0GWILiHsCHE0gIdSWMt8pF4taAE9mGbGvuYNKbav5JXEm0LqcPusKlAkGF1Ym9jAVOX6g/HFGoeycrfrnUwTJCDkDpOns27MfiAW53Qv0Do11Ftbd6xlbRUfZKQUUghzCnx/ctfjAOFxnlOb+WEURuUK3rpW3QKlSvR0t8pfThYmuqcU/bEwv62OqE91qqJdI9aWPRVYe8GScM3l05gFIXwKRkwFuc/3tIcLuikzVO39Nm9umP9Xc0gw1rcbR/YfvxEIvHqFWjTA0l7ggrQzcQbb2CWDmDSCwmDF4ndhapRFhBaHoIYhiNgGzEUGH5pYL/aCHFEQNLBKq6Dx42qSJPFV61qKgpeJFjbi1mTJ0ZDtsghpRjhJqOwHPuG1Oz7zzVo0nyIjKOgylf5PqmAiyorJeex8MAOW2D3Xm+8Y7GEhSjnuiofiPgZxAApzd8sF/gNYGGo2zBI5czu98WJtfvxLvE=" # DOCKER_EMAIL
    - secure: "vUOrmxTSGWh8Q4xdVF7QTF26/gOFhNtjZInamvYQbMUpTrlOP881sG8NmhBcpGT+7MykQkPXeCh/m8VdQHri3EM8AoLKBoFIYsWb+q0qymNFg/EuePyBy1v1e6PkKEid2oDXpAMhaWnhJq8e1uYcrBljly0e4zfP90Qxs1x54vVBIki1PzllHRgJskQy/NHfmnzcjBMHInDl5/PvxPI/5D2BL3zWeVO621Sl12eEuMJL//GWqRD+QAsAkfH3MyLkHSEwdotAHuNlRdF317fufyGEEyibLk0IbKbj+n6ntDJr4mMdBfiU/MY435fWmG8UpINKMGOjiHdikatjkYU3RR8Q8rCYZjjMBJXwEYiPe+7IHyeg71nWSs3JHz30S+adERzbmetQjcHLCpDk3SidlR2+wPy7JeDZGEj2ggbkzTz7BnV8MXUk/BG8/AdyVRSH7ly6zZUOXUc4VIVo3wKOTe6GBG+tbGj/zQzcW8aMpaVJTPg1Px9/lMVIOID2Qr+8DfkiRpcTgvOfnQok5p31ZCyDD3nJRPa37011/G7UbXpbYFF81hsTUvn36t4C6cUz96jA6IYI859LC9VTTWsCRNCyVR8TPzAkB1gRj6/gcnBFcosoXW3Hoyqay+qZ+HLnaUoQAR98xqDnesz2YagzkV4BFclqk/Y3pA6jVq5rFig=" # DOCKER USERNAME
    - COMMIT=${TRAVIS_COMMIT::8}

after_success:
  - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
  - export REPO=elpaso/qgis-testing-environment
  - export TAG=`if [ "$TRAVIS_BRANCH" == "master" ]; then echo "latest"; else echo $TRAVIS_BRANCH ; fi`
  - docker build -f Dockerfile -t $REPO:$COMMIT .
  - docker tag $REPO:$COMMIT $REPO:$TAG
  - docker tag $REPO:$COMMIT $REPO:travis-$TRAVIS_BUILD_NUMBER
  - docker push $REPO
